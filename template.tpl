___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "__wm": "VGVtcGxhdGUtQXV0aG9yX0F1ZGllbmNlUHJvamVjdFVzZXJSZXBvcnQtU2ltby1BaGF2YQ==",
  "categories": ["ANALYTICS", "SURVEY"],
  "version": 1,
  "securityGroups": [],
  "displayName": "AudienceProject UserReport",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Tag for deploying the UserReport SDK and for tracking section views.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "publisherId",
    "displayName": "Publisher ID",
    "simpleValueType": true,
    "alwaysInSummary": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "iabConsent",
    "checkboxText": "(Optional) IAB Consent String",
    "simpleValueType": true,
    "subParams": [
      {
        "type": "TEXT",
        "name": "iabConsentString",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "iabConsent",
            "paramValue": true,
            "type": "EQUALS"
          }
        ],
        "defaultValue": "BOv_CmhOv_CmhAAABBENDAiAAAAYqABAMUA",
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ]
      }
    ]
  },
  {
    "type": "SELECT",
    "name": "tagType",
    "displayName": "Tag Type",
    "macrosInSelect": false,
    "selectItems": [
      {
        "value": "init",
        "displayValue": "Initialize publisher script"
      },
      {
        "value": "trackSection",
        "displayValue": "Track section view"
      }
    ],
    "simpleValueType": true,
    "help": "If you choose \"Initialize publisher script\", the tag will only download the SDK (unless it\u0027s already downloaded). If you choose \"Track section view\", the tag will download the SDK (if necessary), and then track a section view with the ID you provide."
  },
  {
    "type": "TEXT",
    "name": "sectionId",
    "displayName": "Section ID",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "tagType",
        "paramValue": "trackSection",
        "type": "EQUALS"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "valueHint": "00000000-1111-4000-2222-333333333333"
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Load APIs
const injectScript = require('injectScript');
const createQueue = require('createQueue');
const encodeUriComponent = require('encodeUriComponent');
const log = require('logToConsole');

const scriptUrl = 'https://sak.userreport.com/' +
                  encodeUriComponent(data.publisherId) +
                  '/launcher.js' +
                  (data.iabConsent ? '?iab_consent=' + data.iabConsentString : '');

const urq = createQueue('_urq');

if (data.tagType === 'trackSection') urq(['trackSectionPageView', data.sectionId]);

injectScript(scriptUrl, data.gtmOnSuccess, data.gtmOnFailure, 'userreport');


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "_urq"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://sak.userreport.com/*/launcher.js*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Script loads without IAB consent string
  code: |-
    let success, failure;

    const scriptUrl = scriptHost + mockData.publisherId + scriptLib + (mockData.iabConsent ? iabParam + mockData.iabConsentString : '');


    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('injectScript').wasCalledWith(scriptUrl, success, failure, 'userreport');
    assertApi('gtmOnSuccess').wasCalled();
- name: Script loads with IAB consent string
  code: |-
    let success, failure;

    mockData.iabConsent = true;

    const scriptUrl = scriptHost + mockData.publisherId + scriptLib + (mockData.iabConsent ? iabParam + mockData.iabConsentString : '');

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('injectScript').wasCalledWith(scriptUrl, success, failure, 'userreport');
    assertApi('gtmOnSuccess').wasCalled();
- name: Command queue is created
  code: |-
    let success, failure;

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('createQueue').wasCalledWith('_urq');
    assertApi('gtmOnSuccess').wasCalled();
- name: trackSectionPageView is pushed into command queue
  code: |-
    let success, failure;

    mockData.tagType = 'trackSection';

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
setup: "const getType = require('getType');\n\nconst mockData = {\n  publisherId:\
  \ 'publisherId',\n  iabConsent: false,  \n  iabConsentString: 'abcdefgh',\n  tagType:\
  \ 'init',\n  sectionId: 'sectionId'\n};\n\nconst scriptHost = 'https://sak.userreport.com/';\n\
  const scriptLib = '/launcher.js';\nconst iabParam = '?iab_consent=';\n\nmock('injectScript',\
  \ (url, onsuccess, onfailure) => {\n  success = onsuccess;\n  failure = onfailure;\n\
  \  onsuccess();\n});\n\nmock('createQueue', q => {\n  return arg => {\n    if (getType(arg)\
  \ !== 'array') fail('Non-array pushed into _urq');\n    if (arg[0] === 'trackSectionPageView'\
  \ && arg[1] !== mockData.sectionId) fail('Failed to call trackSectionPageView with\
  \ section ID from tag');\n  };\n});"


___NOTES___

Created on 20/04/2020, 14:17:59


